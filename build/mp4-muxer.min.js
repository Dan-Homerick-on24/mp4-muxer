"use strict";var Mp4Muxer=(()=>{var S=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var D=Math.pow;var z=(i,e)=>{for(var t in e)S(i,t,{get:e[t],enumerable:!0})},P=(i,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of I(e))!V.call(i,o)&&o!==t&&S(i,o,{get:()=>e[o],enumerable:!(a=C(e,o))||a.enumerable});return i};var H=i=>P(S({},"__esModule",{value:!0}),i);var k=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var r=(i,e,t)=>(k(i,e,"read from private field"),t?t.call(i):e.get(i)),f=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},c=(i,e,t,a)=>(k(i,e,"write to private field"),a?a.call(i,t):e.set(i,t),t);var _={};z(_,{ArrayBufferWriteTarget:()=>m,WriteTarget:()=>U,default:()=>L});var s,y,p,w,g=class{constructor(){f(this,s,void 0);f(this,y,void 0);f(this,p,void 0);f(this,w,[]);c(this,s,new m)}addVideoChunk(e,t){var o;let a=new Uint8Array(e.byteLength);e.copyTo(a),r(this,w).push(a),(o=t==null?void 0:t.decoderConfig)!=null&&o.description&&(c(this,p,new Uint8Array(t.decoderConfig.description)),console.log(r(this,p)))}finalize(){r(this,s).writeBox({type:"ftyp",contents:new Uint8Array([109,112,52,50,0,0,0,0,105,115,111,109,97,118,99,49,109,112,52,50])});let e={type:"stts",contents:new Uint8Array([0,0,0,0,n(1),n(100),n(100)].flat())},t={type:"stss",contents:new Uint8Array([0,0,0,0,n(1),n(1)].flat())},a={type:"stsc",contents:new Uint8Array([0,0,0,0,n(1),n(1),n(100),n(1)].flat())},o={type:"stsz",contents:new Uint8Array([0,0,0,0,n(0),n(100),r(this,w).flatMap(M=>n(M.byteLength))].flat())},l={type:"stco",contents:new Uint8Array([0,0,0,0,n(1),n(0)].flat())};r(this,s).writeBox({type:"moov",children:[{type:"mvhd",contents:new Uint8Array([0,0,0,0,n(Math.floor(Date.now()/1e3)+2082848400),n(Math.floor(Date.now()/1e3)+2082848400),n(1e3),n(1e4),b(1),E(1),Array(10).fill(0),[65536,0,0,0,65536,0,0,0,1073741824].flatMap(n),Array(24).fill(0),n(2)].flat())},{type:"trak",children:[{type:"tkhd",contents:new Uint8Array([0,0,0,3,n(Math.floor(Date.now()/1e3)+2082848400),n(Math.floor(Date.now()/1e3)+2082848400),n(1),n(0),n(1e4),Array(8).fill(0),0,0,0,0,E(0),0,0,[65536,0,0,0,65536,0,0,0,1073741824].flatMap(n),b(512),b(512)].flat())},{type:"mdia",children:[{type:"mdhd",contents:new Uint8Array([0,0,0,0,n(Math.floor(Date.now()/1e3)+2082848400),n(Math.floor(Date.now()/1e3)+2082848400),n(1e3),n(1e4),85,196,0,0].flat())},{type:"hdlr",contents:new Uint8Array([0,0,0,0,n(0),B("vide"),Array(12).fill(0),B("Video track",!0)].flat())},{type:"minf",children:[{type:"vmhd",contents:new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},{type:"dinf",children:[{type:"dref",contents:new Uint8Array([0,0,0,0,n(1)].flat()),children:[{type:"url ",contents:new Uint8Array([0,0,0,B("",!0)].flat())}]}]},{type:"stbl",children:[{type:"stsd",contents:new Uint8Array([0,0,0,0,n(1)].flat()),children:[{type:"avc1",contents:new Uint8Array([Array(6).fill(0),0,0,0,0,0,0,Array(12).fill(0),A(512),A(512),n(4718592),n(4718592),n(0),A(1),Array(32).fill(0),A(24),O(65535)].flat()),children:[{type:"avcC",contents:r(this,p)}]}]},e,t,a,o,l]}]}]}]}]}),c(this,y,{type:"mdat"}),r(this,s).writeBox(r(this,y)),l.contents=new Uint8Array([0,0,0,0,n(1),n(r(this,s).pos)].flat());let T=r(this,s).pos;r(this,s).pos=r(this,s).offsets.get(l),r(this,s).writeBox(l),r(this,s).pos=T;for(let M of r(this,w))r(this,s).write(M);let v=r(this,s).offsets.get(r(this,y)),F=r(this,s).pos-v;return T=r(this,s).pos,r(this,s).pos=v,r(this,s).writeU32(F),r(this,s).pos=T,r(this,s).finalize()}};s=new WeakMap,y=new WeakMap,p=new WeakMap,w=new WeakMap;var A=i=>{let e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,i,!1),[...e]},O=i=>{let e=new Uint8Array(2);return new DataView(e.buffer).setInt16(0,i,!1),[...e]},n=i=>{let e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,i,!1),[...e]},E=i=>{let e=new Uint8Array(2),t=new DataView(e.buffer);return t.setUint8(0,i),t.setUint8(1,i<<8),[...e]},b=i=>{let e=new Uint8Array(4),t=new DataView(e.buffer);return t.setUint16(0,i,!1),t.setUint16(2,i<<16,!1),[...e]},B=(i,e=!1)=>{let t=Array(i.length).fill(null).map((a,o)=>i.charCodeAt(o));return e&&t.push(0),t};var x,u,U=class{constructor(){this.pos=0;f(this,x,new Uint8Array(8));f(this,u,new DataView(r(this,x).buffer));this.offsets=new WeakMap}writeU32(e){r(this,u).setUint32(0,e,!1),this.write(r(this,x).subarray(0,4))}writeAscii(e){for(let t=0;t<e.length;t++)r(this,u).setUint8(t%8,e.charCodeAt(t)),t%8===7&&this.write(r(this,x));e.length%8!==0&&this.write(r(this,x).subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.pos),e.contents&&!e.children)this.writeU32(e.contents.byteLength+8),this.writeAscii(e.type),this.write(e.contents);else{let t=this.pos;if(this.pos+=4,this.writeAscii(e.type),e.contents&&this.write(e.contents),e.children)for(let l of e.children)this.writeBox(l);let a=this.pos,o=a-t;this.pos=t,this.writeU32(o),this.pos=a}}};x=new WeakMap,u=new WeakMap;var h,d,m=class extends U{constructor(){super();f(this,h,new ArrayBuffer(D(2,16)));f(this,d,new Uint8Array(r(this,h)))}ensureSize(t){let a=r(this,h).byteLength;for(;a<t;)a*=2;if(a===r(this,h).byteLength)return;let o=new ArrayBuffer(a),l=new Uint8Array(o);l.set(r(this,d),0),c(this,h,o),c(this,d,l)}write(t){this.ensureSize(this.pos+t.byteLength),r(this,d).set(t,this.pos),this.pos+=t.byteLength}seek(t){this.pos=t}finalize(){return this.ensureSize(this.pos),r(this,h).slice(0,this.pos)}};h=new WeakMap,d=new WeakMap;var L=g;return H(_);})();
Mp4Muxer = Mp4Muxer.default;
if (typeof module === "object" && typeof module.exports === "object") module.exports = Mp4Muxer;
