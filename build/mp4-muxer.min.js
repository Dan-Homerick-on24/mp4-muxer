"use strict";var Mp4Muxer=(()=>{var se=Object.defineProperty;var $e=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames,Be=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable;var S=Math.pow,ke=(r,e,t)=>e in r?se(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ee=(r,e)=>{for(var t in e||={})Me.call(e,t)&&ke(r,t,e[t]);if(Be)for(var t of Be(e))Ge.call(e,t)&&ke(r,t,e[t]);return r};var Ke=(r,e)=>{for(var t in e)se(r,t,{get:e[t],enumerable:!0})},Xe=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of qe(e))!Me.call(r,n)&&n!==t&&se(r,n,{get:()=>e[n],enumerable:!(s=$e(e,n))||s.enumerable});return r};var Ye=r=>Xe(se({},"__esModule",{value:!0}),r);var we=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var i=(r,e,t)=>(we(r,e,"read from private field"),t?t.call(r):e.get(r)),u=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},b=(r,e,t,s)=>(we(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);var m=(r,e,t)=>(we(r,e,"access private method"),t);var Ut={};Ke(Ut,{ArrayBufferTarget:()=>G,FileSystemWritableFileStreamTarget:()=>K,Muxer:()=>fe,StreamTarget:()=>O});var f=new Uint8Array(8),x=new DataView(f.buffer),v=r=>[(r%256+256)%256],d=r=>(x.setUint16(0,r,!1),[f[0],f[1]]),De=r=>(x.setInt16(0,r,!1),[f[0],f[1]]),ge=r=>(x.setUint32(0,r,!1),[f[1],f[2],f[3]]),a=r=>(x.setUint32(0,r,!1),[f[0],f[1],f[2],f[3]]),ze=r=>(x.setUint32(0,Math.floor(r/S(2,32)),!1),x.setUint32(4,r,!1),[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]]),xe=r=>(x.setUint8(0,r),x.setUint8(1,r<<8),[f[0],f[1]]),q=r=>(x.setUint16(0,r,!1),x.setUint16(2,r<<16,!1),[f[0],f[1],f[2],f[3]]),g=(r,e=!1)=>{let t=Array(r.length).fill(null).map((s,n)=>r.charCodeAt(n));return e&&t.push(0),t},A=r=>r&&r[r.length-1],I=(r,e,t=!0)=>{let s=r*e;return t?Math.round(s):s};var Ie=[65536,0,0,0,65536,0,0,0,1073741824].map(a),C=(r,e,t)=>({type:r,contents:e&&new Uint8Array(e.flat(10)),children:t}),y=(r,e,t,s,n)=>C(r,[v(e),ge(t),s!=null?s:[]],n),Oe=r=>r?C("ftyp",[g("isom"),a(0),g("iso4"),g("hvc1")]):C("ftyp",[g("isom"),a(0),g("isom"),g("avc1"),g("mp41")]),Pe=()=>({type:"mdat",largeSize:!0}),Le=(r,e)=>C("moov",null,[Ze(e,r),...r.map(t=>je(t,e))]),Ze=(r,e)=>{let t=I(Math.max(0,...e.filter(n=>n.samples.length>0).map(n=>A(n.samples).timestamp+A(n.samples).duration)),ne),s=Math.max(...e.map(n=>n.id))+1;return y("mvhd",0,0,[a(r),a(r),a(ne),a(t),q(1),xe(1),Array(10).fill(0),Ie,Array(24).fill(0),a(s)])},je=(r,e)=>C("trak",null,[Je(r,e),Qe(r,e)]),Je=(r,e)=>{let t=A(r.samples),s=I(t?t.timestamp+t.duration:0,ne);return y("tkhd",0,3,[a(e),a(e),a(r.id),a(0),a(s),Array(8).fill(0),d(0),d(0),xe(r.info.type==="audio"?1:0),d(0),Ie,q(r.info.type==="video"?r.info.width:0),q(r.info.type==="video"?r.info.height:0)])},Qe=(r,e)=>C("mdia",null,[et(r,e),tt(r.info.type==="video"?"vide":"soun"),rt(r)]),et=(r,e)=>{let t=A(r.samples),s=I(t?t.timestamp+t.duration:0,r.timescale);return y("mdhd",0,0,[a(e),a(e),a(r.timescale),a(s),d(21956),d(0)])},tt=r=>y("hdlr",0,0,[g("mhlr"),g(r),a(0),a(0),a(0),g("mp4-muxer-hdlr")]),rt=r=>C("minf",null,[r.info.type==="video"?it():st(),nt(),lt(r)]),it=()=>y("vmhd",0,1,[d(0),d(0),d(0),d(0)]),st=()=>y("smhd",0,0,[d(0),d(0)]),nt=()=>C("dinf",null,[at()]),at=()=>y("dref",0,0,[a(1)],[ot()]),ot=()=>y("url ",0,1),lt=r=>C("stbl",null,[ht(r),ct(r),yt(r),bt(r),Tt(r),Ct(r)]),ht=r=>y("stsd",0,0,[a(1)],[r.info.type==="video"?ut(r.info.codec==="avc"?"avc1":"hvc1",r,r.info.codec==="avc"?dt(r):mt(r)):ft("mp4a",r,pt(r))]),ut=(r,e,t)=>C(r,[Array(6).fill(0),d(1),d(0),d(0),Array(12).fill(0),d(e.info.width),d(e.info.height),a(4718592),a(4718592),a(0),d(1),Array(32).fill(0),d(24),De(65535)],[t]),dt=r=>r.codecPrivate&&C("avcC",[...r.codecPrivate]),mt=r=>r.codecPrivate&&C("hvcC",[...r.codecPrivate]),ft=(r,e,t)=>C(r,[Array(6).fill(0),d(1),d(0),d(0),a(0),d(e.info.numberOfChannels),d(16),d(0),d(0),q(e.info.sampleRate)],[t]),pt=r=>y("esds",0,0,[a(58753152),v(32+r.codecPrivate.byteLength),d(1),v(0),a(75530368),v(18+r.codecPrivate.byteLength),v(64),v(21),ge(0),a(130071),a(130071),a(92307584),v(r.codecPrivate.byteLength),...r.codecPrivate,a(109084800),v(1),v(2)]),ct=r=>y("stts",0,0,[a(r.timeToSampleTable.length),r.timeToSampleTable.map(e=>[a(e.sampleCount),a(e.sampleDelta)])]),yt=r=>{if(r.samples.every(t=>t.type==="key"))return null;let e=[...r.samples.entries()].filter(([,t])=>t.type==="key");return y("stss",0,0,[a(e.length),e.map(([t])=>a(t+1))])},bt=r=>y("stsc",0,0,[a(r.compactlyCodedChunkTable.length),r.compactlyCodedChunkTable.map(e=>[a(e.firstChunk),a(e.samplesPerChunk),a(1)])]),Tt=r=>y("stsz",0,0,[a(0),a(r.samples.length),r.samples.map(e=>a(e.size))]),Ct=r=>r.writtenChunks.length>0&&A(r.writtenChunks).offset>=S(2,32)?y("co64",0,0,[a(r.writtenChunks.length),r.writtenChunks.map(e=>ze(e.offset))]):y("stco",0,0,[a(r.writtenChunks.length),r.writtenChunks.map(e=>a(e.offset))]);var G=class{constructor(){this.buffer=null}},O=class{constructor(e,t,s){this.onData=e;this.onDone=t;this.options=s}},K=class{constructor(e){this.stream=e}};var U,P,X=class{constructor(){this.pos=0;u(this,U,new Uint8Array(8));u(this,P,new DataView(i(this,U).buffer));this.offsets=new WeakMap}seek(e){this.pos=e}writeU32(e){i(this,P).setUint32(0,e,!1),this.write(i(this,U).subarray(0,4))}writeU64(e){i(this,P).setUint32(0,Math.floor(e/S(2,32)),!1),i(this,P).setUint32(4,e,!1),this.write(i(this,U).subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)i(this,P).setUint8(t%8,e.charCodeAt(t)),t%8===7&&this.write(i(this,U));e.length%8!==0&&this.write(i(this,U).subarray(0,e.length%8))}writeBox(e){var t,s;if(this.offsets.set(e,this.pos),e.contents&&!e.children)this.writeBoxHeader(e,(t=e.size)!=null?t:e.contents.byteLength+8),this.write(e.contents);else{let n=this.pos;if(this.writeBoxHeader(e,0),e.contents&&this.write(e.contents),e.children)for(let h of e.children)h&&this.writeBox(h);let o=this.pos,l=(s=e.size)!=null?s:o-n;this.pos=n,this.writeBoxHeader(e,l),this.pos=o}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}patchBox(e){let t=this.pos;this.pos=this.offsets.get(e),this.writeBox(e),this.pos=t}};U=new WeakMap,P=new WeakMap;var j,B,R,J,ve,oe=class extends X{constructor(t){super();u(this,J);u(this,j,void 0);u(this,B,new ArrayBuffer(S(2,16)));u(this,R,new Uint8Array(i(this,B)));b(this,j,t)}write(t){m(this,J,ve).call(this,this.pos+t.byteLength),i(this,R).set(t,this.pos),this.pos+=t.byteLength}finalize(){m(this,J,ve).call(this,this.pos),i(this,j).buffer=i(this,B).slice(0,this.pos)}};j=new WeakMap,B=new WeakMap,R=new WeakMap,J=new WeakSet,ve=function(t){let s=i(this,B).byteLength;for(;s<t;)s*=2;if(s===i(this,B).byteLength)return;let n=new ArrayBuffer(s),o=new Uint8Array(n);o.set(i(this,R),0),b(this,B,n),b(this,R,o)};var N,k,Y=class extends X{constructor(t){super();u(this,N,void 0);u(this,k,[]);b(this,N,t)}write(t){i(this,k).push({data:t.slice(),start:this.pos}),this.pos+=t.byteLength}flush(){if(i(this,k).length===0)return;let t=[],s=[...i(this,k)].sort((n,o)=>n.start-o.start);t.push({start:s[0].start,size:s[0].data.byteLength});for(let n=1;n<s.length;n++){let o=t[t.length-1],l=s[n];l.start<=o.start+o.size?o.size=Math.max(o.size,l.start+l.data.byteLength-o.start):t.push({start:l.start,size:l.data.byteLength})}for(let n of t){n.data=new Uint8Array(n.size);for(let o of i(this,k))n.start<=o.start&&o.start<n.start+n.size&&n.data.set(o.data,o.start-n.start);i(this,N).onData(n.data,n.start)}i(this,k).length=0}finalize(){var t,s;(s=(t=i(this,N)).onDone)==null||s.call(t)}};N=new WeakMap,k=new WeakMap;var F=S(2,24),wt=2,V,T,Q,Ae,he,_e,ue,Fe,H,ae,Z=class extends X{constructor(t){super();u(this,Q);u(this,he);u(this,ue);u(this,H);u(this,V,void 0);u(this,T,[]);b(this,V,t)}write(t){m(this,Q,Ae).call(this,t,this.pos),m(this,H,ae).call(this),this.pos+=t.byteLength}finalize(){var t,s;m(this,H,ae).call(this,!0),(s=(t=i(this,V)).onDone)==null||s.call(t)}};V=new WeakMap,T=new WeakMap,Q=new WeakSet,Ae=function(t,s){let n=i(this,T).findIndex(w=>w.start<=s&&s<w.start+F);n===-1&&(n=m(this,ue,Fe).call(this,s));let o=i(this,T)[n],l=s-o.start,h=t.subarray(0,Math.min(F-l,t.byteLength));o.data.set(h,l);let L={start:l,end:l+h.byteLength};if(m(this,he,_e).call(this,o,L),o.written[0].start===0&&o.written[0].end===F&&(o.shouldFlush=!0),i(this,T).length>wt){for(let w=0;w<i(this,T).length-1;w++)i(this,T)[w].shouldFlush=!0;m(this,H,ae).call(this)}h.byteLength<t.byteLength&&m(this,Q,Ae).call(this,t.subarray(h.byteLength),s+h.byteLength)},he=new WeakSet,_e=function(t,s){let n=0,o=t.written.length-1,l=-1;for(;n<=o;){let h=Math.floor(n+(o-n+1)/2);t.written[h].start<=s.start?(n=h+1,l=h):o=h-1}for(t.written.splice(l+1,0,s),(l===-1||t.written[l].end<s.start)&&l++;l<t.written.length-1&&t.written[l].end>=t.written[l+1].start;)t.written[l].end=Math.max(t.written[l].end,t.written[l+1].end),t.written.splice(l+1,1)},ue=new WeakSet,Fe=function(t){let n={start:Math.floor(t/F)*F,data:new Uint8Array(F),written:[],shouldFlush:!1};return i(this,T).push(n),i(this,T).sort((o,l)=>o.start-l.start),i(this,T).indexOf(n)},H=new WeakSet,ae=function(t=!1){for(let s=0;s<i(this,T).length;s++){let n=i(this,T)[s];if(!(!n.shouldFlush&&!t)){for(let o of n.written)i(this,V).onData(n.data.subarray(o.start,o.end),n.start+o.start);i(this,T).splice(s--,1)}}};var le=class extends Z{constructor(e){super(new O((t,s)=>e.stream.write({type:"write",data:t,position:s})))}};var ne=1e3,gt=2082844800,xt=.5,vt=["avc","hevc"],At=["aac"],St=["strict","offset"],p,c,M,E,D,pe,ee,ce,Re,ye,Ne,be,Ve,Te,He,te,Se,Ce,We,W,de,$,me,re,Ue,fe=class{constructor(e){u(this,ce);u(this,ye);u(this,be);u(this,Te);u(this,te);u(this,Ce);u(this,W);u(this,$);u(this,re);u(this,p,void 0);u(this,c,void 0);u(this,M,void 0);u(this,E,null);u(this,D,null);u(this,pe,Math.floor(Date.now()/1e3)+gt);u(this,ee,!1);var t;if(m(this,ce,Re).call(this,e),this.target=e.target,b(this,p,Ee({firstTimestampBehavior:"strict"},e)),e.target instanceof G)b(this,c,new oe(e.target));else if(e.target instanceof O)b(this,c,(t=e.target.options)!=null&&t.chunked?new Z(e.target):new Y(e.target));else if(e.target instanceof K)b(this,c,new le(e.target));else throw new Error(`Invalid target: ${e.target}`);m(this,ye,Ne).call(this),m(this,be,Ve).call(this)}addVideoChunk(e,t,s){let n=new Uint8Array(e.byteLength);e.copyTo(n),this.addVideoChunkRaw(n,e.type,s!=null?s:e.timestamp,e.duration,t)}addVideoChunkRaw(e,t,s,n,o){if(m(this,re,Ue).call(this),!i(this,p).video)throw new Error("No video track declared.");m(this,te,Se).call(this,i(this,E),e,t,s,n,o)}addAudioChunk(e,t,s){let n=new Uint8Array(e.byteLength);e.copyTo(n),this.addAudioChunkRaw(n,e.type,s!=null?s:e.timestamp,e.duration,t)}addAudioChunkRaw(e,t,s,n,o){if(m(this,re,Ue).call(this),!i(this,p).audio)throw new Error("No audio track declared.");m(this,te,Se).call(this,i(this,D),e,t,s,n,o)}finalize(){i(this,E)&&m(this,W,de).call(this,i(this,E)),i(this,D)&&m(this,W,de).call(this,i(this,D));let e=i(this,c).offsets.get(i(this,M)),t=i(this,c).pos-e;i(this,M).size=t,i(this,c).patchBox(i(this,M));let s=Le([i(this,E),i(this,D)].filter(Boolean),i(this,pe));i(this,c).writeBox(s),m(this,$,me).call(this),i(this,c).finalize(),b(this,ee,!0)}};p=new WeakMap,c=new WeakMap,M=new WeakMap,E=new WeakMap,D=new WeakMap,pe=new WeakMap,ee=new WeakMap,ce=new WeakSet,Re=function(e){if(e.video&&!vt.includes(e.video.codec))throw new Error(`Unsupported video codec: ${e.video.codec}`);if(e.audio&&!At.includes(e.audio.codec))throw new Error(`Unsupported audio codec: ${e.audio.codec}`);if(e.firstTimestampBehavior&&!St.includes(e.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`)},ye=new WeakSet,Ne=function(){var t;let e=((t=i(this,p).video)==null?void 0:t.codec)==="hevc";i(this,c).writeBox(Oe(e)),b(this,M,Pe()),i(this,c).writeBox(i(this,M)),m(this,$,me).call(this)},be=new WeakSet,Ve=function(){if(i(this,p).video&&b(this,E,{id:1,info:{type:"video",codec:i(this,p).video.codec,width:i(this,p).video.width,height:i(this,p).video.height},timescale:720,codecPrivate:new Uint8Array(0),samples:[],writtenChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),i(this,p).audio){let e=m(this,Te,He).call(this,2,i(this,p).audio.sampleRate,i(this,p).audio.numberOfChannels);b(this,D,{id:i(this,p).video?2:1,info:{type:"audio",codec:i(this,p).audio.codec,numberOfChannels:i(this,p).audio.numberOfChannels,sampleRate:i(this,p).audio.sampleRate},timescale:i(this,p).audio.sampleRate,codecPrivate:e,samples:[],writtenChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}},Te=new WeakSet,He=function(e,t,s){let o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(t),l=s,h="";h+=e.toString(2).padStart(5,"0"),h+=o.toString(2).padStart(4,"0"),o===15&&(h+=t.toString(2).padStart(24,"0")),h+=l.toString(2).padStart(4,"0");let L=Math.ceil(h.length/8)*8;h=h.padEnd(L,"0");let w=new Uint8Array(h.length/8);for(let z=0;z<h.length;z+=8)w[z/8]=parseInt(h.slice(z,z+8),2);return w},te=new WeakSet,Se=function(e,t,s,n,o,l){var w;let h=n/1e6,L=o/1e6;if(e.firstTimestamp===void 0&&(e.firstTimestamp=h),h=m(this,Ce,We).call(this,h,e),(!e.currentChunk||h-e.currentChunk.startTimestamp>=xt)&&(e.currentChunk&&m(this,W,de).call(this,e),e.currentChunk={startTimestamp:h,sampleData:[],sampleCount:0}),e.currentChunk.sampleData.push(t),e.currentChunk.sampleCount++,(w=l==null?void 0:l.decoderConfig)!=null&&w.description&&(e.codecPrivate=new Uint8Array(l.decoderConfig.description)),e.samples.push({timestamp:h,duration:L,size:t.byteLength,type:s}),e.lastTimescaleUnits!==null){let z=I(h,e.timescale,!1),ie=Math.round(z-e.lastTimescaleUnits);e.lastTimescaleUnits+=ie;let _=A(e.timeToSampleTable);_.sampleCount===1?(_.sampleDelta=ie,_.sampleCount++):_.sampleDelta===ie?_.sampleCount++:(_.sampleCount--,e.timeToSampleTable.push({sampleCount:2,sampleDelta:ie}))}else e.lastTimescaleUnits=0,e.timeToSampleTable.push({sampleCount:1,sampleDelta:I(L,e.timescale)})},Ce=new WeakSet,We=function(e,t){if(i(this,p).firstTimestampBehavior==="strict"&&t.lastTimestamp===-1&&e!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${e}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(i(this,p).firstTimestampBehavior==="offset"&&(e-=t.firstTimestamp),e<t.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${t.lastTimestamp*1e6} to ${e*1e6}).`);return e},W=new WeakSet,de=function(e){if(e.currentChunk){e.currentChunk.offset=i(this,c).pos;for(let t of e.currentChunk.sampleData)i(this,c).write(t);e.currentChunk.sampleData=null,(e.compactlyCodedChunkTable.length===0||A(e.compactlyCodedChunkTable).samplesPerChunk!==e.currentChunk.sampleCount)&&e.compactlyCodedChunkTable.push({firstChunk:e.writtenChunks.length+1,samplesPerChunk:e.currentChunk.sampleCount}),e.writtenChunks.push(e.currentChunk),m(this,$,me).call(this)}},$=new WeakSet,me=function(){i(this,c)instanceof Y&&i(this,c).flush()},re=new WeakSet,Ue=function(){if(i(this,ee))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};return Ye(Ut);})();
if (typeof module === "object" && typeof module.exports === "object") {
	module.exports.Muxer = Mp4Muxer.Muxer;
	module.exports.ArrayBufferTarget = Mp4Muxer.ArrayBufferTarget;
	module.exports.StreamTarget = Mp4Muxer.StreamTarget;
	module.exports.FileSystemWritableFileStreamTarget = Mp4Muxer.FileSystemWritableFileStreamTarget;
}
